{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "Get Latest Report Of CVE",
    "aliasName": null,
    "tag": null,
    "description": "Playbook fetches latest report of CVE from NIST-NVD and will update record.",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [
        "CVERecord"
    ],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/d99a8b59-a957-4d95-ac1c-da59ec91a117",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/c6e4f745-d9c2-45ba-ab23-f84964356b41",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "Configuration",
            "description": null,
            "arguments": {
                "record": "{{vars.input.records[0]}}"
            },
            "status": null,
            "top": "165",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "2313edc1-d47d-4e0c-86c6-20aee24aafd3"
        },
        {
            "@type": "WorkflowStep",
            "name": "CVE Data Found In NVD",
            "description": null,
            "arguments": {
                "type": "InputBased",
                "input": {
                    "schema": {
                        "title": "CVE Latest Report Update",
                        "description": "<h3>Successfully Updated CVE<\/h3>",
                        "inputVariables": []
                    }
                },
                "record": "{{ vars.input.records[0][\"@id\"] }}",
                "agent_id": null,
                "resources": "c_v_es",
                "owner_detail": {
                    "isAssigned": false,
                    "assignedToRecord": false
                },
                "isRecordLinked": true,
                "step_variables": [],
                "response_mapping": {
                    "options": [
                        {
                            "option": "Ok",
                            "primary": true
                        }
                    ],
                    "duplicateOption": false
                },
                "email_notification": {
                    "enabled": false,
                    "smtpParameters": []
                },
                "inline_channel_list": [],
                "external_channel_list": [],
                "unauthenticated_input": false
            },
            "status": null,
            "top": "705",
            "left": "125",
            "stepType": "\/api\/3\/workflow_step_types\/fc04082a-d7dc-4299-96fb-6837b1baa0fe",
            "group": null,
            "uuid": "7a376be8-2703-4c18-9756-2fdc0985d440"
        },
        {
            "@type": "WorkflowStep",
            "name": "CVE Data Not Found In NVD",
            "description": null,
            "arguments": {
                "type": "InputBased",
                "input": {
                    "schema": {
                        "title": "CVE Latest Report Update",
                        "description": "<h3>CVE not found in NIST National Vulnerability Database<\/h3>",
                        "inputVariables": []
                    }
                },
                "record": "{{ vars.input.records[0][\"@id\"] }}",
                "agent_id": null,
                "resources": "c_v_es",
                "owner_detail": {
                    "isAssigned": false,
                    "assignedToRecord": false
                },
                "isRecordLinked": true,
                "step_variables": [],
                "response_mapping": {
                    "options": [
                        {
                            "option": "Ok",
                            "primary": true
                        }
                    ],
                    "duplicateOption": false
                },
                "email_notification": {
                    "enabled": false,
                    "smtpParameters": []
                },
                "inline_channel_list": [],
                "external_channel_list": [],
                "unauthenticated_input": false
            },
            "status": null,
            "top": "700",
            "left": "480",
            "stepType": "\/api\/3\/workflow_step_types\/fc04082a-d7dc-4299-96fb-6837b1baa0fe",
            "group": null,
            "uuid": "1f5df2cd-d88b-4300-b425-4d572130cd46"
        },
        {
            "@type": "WorkflowStep",
            "name": "Get CVE by ID",
            "description": null,
            "arguments": {
                "name": "NIST National Vulnerability Database",
                "config": "09666536-d2b4-4833-adf3-5df2d57b8e2b",
                "params": {
                    "cveId": "{{vars.record['cVEID']}}"
                },
                "version": "1.0.1",
                "connector": "nist-nvd",
                "operation": "get_specific_cve_details",
                "ignore_errors": false,
                "operationTitle": "Get Specific CVE ID Details",
                "pickFromTenant": false,
                "step_variables": {
                    "CVEData": "{{vars.result.data.vulnerabilities}}"
                }
            },
            "status": null,
            "top": "300",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "6800b249-0c70-469c-aafb-f9205954b791"
        },
        {
            "@type": "WorkflowStep",
            "name": "Is CVE Data Found In NVD",
            "description": null,
            "arguments": {
                "conditions": [
                    {
                        "option": "Yes",
                        "step_iri": "\/api\/3\/workflow_steps\/7a376be8-2703-4c18-9756-2fdc0985d440",
                        "condition": "{{ vars.CVEData | length > 0 }}",
                        "step_name": "CVE Data Found In NVD"
                    },
                    {
                        "option": "No",
                        "default": true,
                        "step_iri": "\/api\/3\/workflow_steps\/1f5df2cd-d88b-4300-b425-4d572130cd46",
                        "step_name": "CVE Data Not Found In NVD"
                    }
                ]
            },
            "status": null,
            "top": "570",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/12254cf5-5db7-4b1a-8cb1-3af081924b28",
            "group": null,
            "uuid": "3a6ba495-43d7-4997-b7ca-1179ce541b89"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "route": "5df7b3a7-1158-44ef-bc1b-e3d6b1634be0",
                "resources": [
                    "c_v_es"
                ],
                "inputVariables": [],
                "step_variables": {
                    "input": {
                        "params": [],
                        "records": "{{vars.input.records}}"
                    }
                },
                "displayConditions": {
                    "c_v_es": {
                        "sort": [],
                        "limit": 30,
                        "logic": "AND",
                        "filters": []
                    }
                },
                "executeButtonText": "Execute",
                "noRecordExecution": false,
                "singleRecordExecution": true
            },
            "status": null,
            "top": "30",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/f414d039-bb0d-4e59-9c39-a8f1e880b18a",
            "group": null,
            "uuid": "c6e4f745-d9c2-45ba-ab23-f84964356b41"
        },
        {
            "@type": "WorkflowStep",
            "name": "Update CVE",
            "description": null,
            "arguments": {
                "when": "{{vars.CVEData | length > 0}}",
                "resource": {
                    "cWEID": "{% if vars.CVEData[0].cve.get(\"weaknesses\", \"\") != \"\" %}{% set cwe = vars.CVEData[0].cve['weaknesses'] | json_query(\"[*][description][][][value][]\") | unique %}{{cwe | join(', ')}}{% endif %}",
                    "__link": {
                        "recordTags": "{% if (vars.CVEData[0].cve.keys() | string | regex_findall('cisa')) %}{{\"KEV\"}}{% endif %}"
                    },
                    "cVEURL": "https:\/\/nvd.nist.gov\/vuln\/detail\/{{vars.CVEData[0].cve['id']}}",
                    "cVSSv2": "{% if  (vars.CVEData[0].cve.metrics.keys() | string | regex_findall('cvssMetricV2'))[0] %}\n| Source | Base Score | Vector |\n| --- | --- | --- |{% for item in vars.CVEData[0].cve['metrics']['cvssMetricV2'] %}\n| {{item.source}} | <span data-tomark-pass=\"\" style=color:{{\"Severity\" | picklist(item.baseSeverity, \"color\")}}>{{item.cvssData.baseScore}} <\/span>| {{item.cvssData.vectorString}} |{% endfor %}{% endif %}\n",
                    "cVSSv3": "{% if  (vars.CVEData[0].cve.metrics.keys() | string | regex_findall('cvssMetricV3[0-9]'))[0] %}\n{% set  version = (vars.CVEData[0].cve.metrics.keys() | string | regex_findall('cvssMetricV3[0-9]'))[0] %}\n| Source | Base Score | Vector |\n| --- | --- | --- |{% for item in vars.CVEData[0].cve.metrics.get(version) %}\n| {{item.source}} | <span data-tomark-pass=\"\" style=color:{{\"Severity\" | picklist(item.cvssData.baseSeverity, \"color\")}}>{{item.cvssData.baseScore}} <\/span>| {{item.cvssData.vectorString}} |{% endfor %}{% endif %}\n",
                    "reference": "{% if vars.CVEData[0].cve['references'] %}\n| Hyperlink | Tags | Source |\n| --- | --- | --- |{% for item in vars.CVEData[0].cve['references'] %}\n| <a href=\"{{item.url}}\">{{item.url}}<\/a> | {{item.tags | join(', ')}} | {{item.source}} |{% endfor %}{% endif %}",
                    "cPEsDetail": "{% if vars.CVEData[0].cve.configurations[0]['nodes'][0]['cpeMatch'] %}\n| CPE Name | Is Vulnerable | Match Id |\n| --- | --- | --- |{% for item in vars.CVEData[0].cve.configurations[0]['nodes'][0]['cpeMatch'] %}\n| {{item.criteria}} | {{item.vulnerable}} | {{item.matchCriteriaId}} |{% endfor %}{% endif %}",
                    "sourceData": "{{vars.CVEData[0].cve | toJSON }}",
                    "description": "{{(vars.CVEData[0].cve.descriptions  | json_query(\"[?lang == 'en'].value\"))[0] }}",
                    "kEVTagSource": "\/api\/3\/picklists\/b5492d79-fe49-43ab-9786-f8e60fc12204",
                    "publishedDate": "{{arrow.get(vars.CVEData[0].cve['published']).int_timestamp}}",
                    "isInKEVCatalog": "{% if (vars.CVEData[0].cve.keys() | string | regex_findall('cisa')) %}{{\"YesNoInput\" | picklist(\"Yes\", \"@id\")}}{% else %}{{\"YesNoInput\" | picklist(\"No\", \"@id\")}}{% endif %}",
                    "lastModifiedOn": "{{arrow.get(vars.CVEData[0].cve['lastModified']).int_timestamp}}",
                    "evaluatorImpact": "{{vars.CVEData[0].cve['evaluatorImpact']}}",
                    "identifierSource": "{{vars.CVEData[0].cve.sourceIdentifier}}",
                    "vendorStatements": "{% if 'vendorComments' in vars.CVEData[0].cve %}\n[Vendor Statements](https:\/\/nvd.nist.gov\/vuln\/vendor-comments)\n\n{% for item in vars.CVEData[0].cve['vendorComments'] %}\n<p><h5>{{item.organization}} ({{item.lastModified.split('T')[0] }}) <\/h5>&emsp;{{item.comment}}<\/p>\n{% endfor %}\n{% endif %}\n",
                    "evaluatorSolution": "{{vars.CVEData[0].cve['evaluatorImpact']}}",
                    "vulnerabilityStatus": "{{\"CVEVulnerabilityStatus\" | picklist(vars.CVEData[0].cve['vulnStatus'], \"@id\")}}",
                    "vulnerabilityName": "{{vars.item.cve.cisaVulnerabilityName}}",
                    "action": "{{vars.item.cve.cisaRequiredAction}}",   
                    "dateAddedToKEVCatalog": "{{arrow.get(vars.item.cve.cisaExploitAdd).int_timestamp}}",
                    "responseDueDate": "{{arrow.get(vars.item.cve.cisaActionDue).int_timestamp}}"
                },
                "operation": "Append",
                "collection": "{{vars.record['@id']}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/c_v_es",
                "fieldOperation": {
                    "recordTags": "Append"
                },
                "step_variables": []
            },
            "status": null,
            "top": "435",
            "left": "300",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "505d8765-231e-4967-9dbd-68adc4318428"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "Configuration -> Get CVE by ID",
            "targetStep": "\/api\/3\/workflow_steps\/6800b249-0c70-469c-aafb-f9205954b791",
            "sourceStep": "\/api\/3\/workflow_steps\/2313edc1-d47d-4e0c-86c6-20aee24aafd3",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "1e59b00a-c262-4243-b78c-167548d1ea92"
        },
        {
            "@type": "WorkflowRoute",
            "name": "CVE Found In NVD -> CVE Data Found In NVD",
            "targetStep": "\/api\/3\/workflow_steps\/7a376be8-2703-4c18-9756-2fdc0985d440",
            "sourceStep": "\/api\/3\/workflow_steps\/3a6ba495-43d7-4997-b7ca-1179ce541b89",
            "label": "Yes",
            "isExecuted": false,
            "group": null,
            "uuid": "776bef4a-d9f7-44e9-aede-899476a508c6"
        },
        {
            "@type": "WorkflowRoute",
            "name": "CVE Found In NVD -> CVE Data Not Found In NVD",
            "targetStep": "\/api\/3\/workflow_steps\/1f5df2cd-d88b-4300-b425-4d572130cd46",
            "sourceStep": "\/api\/3\/workflow_steps\/3a6ba495-43d7-4997-b7ca-1179ce541b89",
            "label": "No",
            "isExecuted": false,
            "group": null,
            "uuid": "8d43adf1-f54b-4480-8ba6-307477c867c8"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Get CVE by ID -> Update CVE",
            "targetStep": "\/api\/3\/workflow_steps\/505d8765-231e-4967-9dbd-68adc4318428",
            "sourceStep": "\/api\/3\/workflow_steps\/6800b249-0c70-469c-aafb-f9205954b791",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "cdf91001-d653-4078-ab0c-b84fec268841"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> Configuration",
            "targetStep": "\/api\/3\/workflow_steps\/2313edc1-d47d-4e0c-86c6-20aee24aafd3",
            "sourceStep": "\/api\/3\/workflow_steps\/c6e4f745-d9c2-45ba-ab23-f84964356b41",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "097cf01e-41ad-41b6-bc63-57561929436c"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Update CVE -> CVE Found In NVD",
            "targetStep": "\/api\/3\/workflow_steps\/3a6ba495-43d7-4997-b7ca-1179ce541b89",
            "sourceStep": "\/api\/3\/workflow_steps\/505d8765-231e-4967-9dbd-68adc4318428",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "3319a813-e084-4e1f-9b35-89a1ecc52448"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "9f03dd23-93b8-4834-bf2c-f877c8eae327",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "CVE",
        "KEV",
        "ManualTrigger"
    ]
}